<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Episode â€¢ Travel & Ask</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/site.css">
</head>
<body>
  <nav class="nav">
    <div class="container nav-inner">
      <div class="brand">
        <div class="logo"><img src="/assets/logo.png" alt="Travel &amp; Ask logo" onerror="this.src='/assets/logo.svg'"></div>
        <div class="brand-name"><span class="accent">Travel</span> &amp; Ask</div>
      </div>
      <div class="links">
        <a href="/">Home</a>
        <a href="/episodes/">Episodes</a>
        <a href="/about/">About</a>
      </div>
    </div>
  </nav>

  <main>
    <section class="section">
      <div class="container" id="episode">
        <div class="card" id="card">
          <img id="thumb" class="card-img" alt="" style="display:none">
          <h1 class="section-title" id="title">Episode</h1>
          <p id="desc" style="margin-bottom:12px;color:var(--muted)"></p>
          <div id="video" style="aspect-ratio:16/9;display:none">
            <iframe id="frame" width="100%" height="100%" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
        </div>
        <p><a class="btn btn-secondary" href="/episodes/">Back to Episodes</a></p>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <small>&copy; <span id="y"></span> Travel &amp; Ask</small>
    </div>
  </footer>

  <script>document.getElementById('y').textContent = new Date().getFullYear()</script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    const firebaseConfig = {"projectId":"studio-6465048620-21f78","appId":"1:479548757971:web:6c8fd092f8c2e983c24126","apiKey":"AIzaSyDMe0ExQbmfplEAlcGfwZzFETj4tU6TkNw","authDomain":"studio-6465048620-21f78.firebaseapp.com","measurementId":"","messagingSenderId":"479548757971"};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const params=new URLSearchParams(location.search); const id=params.get('id');
    let placeholders = {};
    try { const res = await fetch('/SRC/lib/placeholder-images.json'); if (res.ok) { const j = await res.json(); j.placeholderImages.forEach(p => placeholders[p.id] = p.imageUrl); } } catch {}
    async function load(){
      const titleEl=document.getElementById('title'); const descEl=document.getElementById('desc'); const imgEl=document.getElementById('thumb'); const vEl=document.getElementById('video'); const f=document.getElementById('frame');
      if(!id){ titleEl.textContent='Episode not found'; return }
      try{
        const snap=await getDoc(doc(db,'episodes',id));
        if(!snap.exists()){ titleEl.textContent='Episode not found'; return }
        const d=snap.data();
        titleEl.textContent=d.title||[d.city,d.state].filter(Boolean).join(', ')||'Episode';
        descEl.textContent=d.description||d.summary||'';
        const thumb=d.thumbnail||placeholders[d.imageId]||''; if(thumb){ imgEl.src=thumb; imgEl.alt=titleEl.textContent; imgEl.style.display='block'; }
        const url=d.videoUrl||''; if(url){ f.src=url; vEl.style.display='block'; }
      }catch(e){ titleEl.textContent='Episode unavailable' }
    }
    load()
  </script>
</body>
</html>